<!doctype html>
<html>
<head>
<script src="twofish.js"></script>
</head>
<body>
<input type="text" id="key" placeholder="key" value="foobar">
<textarea id="input">Hello world!</textarea>
<label for="cbc"><input type="checkbox" id="cbc"> CBC</label>
<button type="button" id="encrypt">Encrypt</button>
<button type="button" id="decrypt">Decrypt</button>
<textarea id="output"></textarea>

<script>
window.addEventListener('load', _ => {
	const Twofish = require('Twofish');

	const tf = new Twofish();

	let key2 = 'foobar';
	let plaintext = 'Hello world!';

    const fromBase64 = string => {
        return atob(string).split('|').map(hex => parseInt(hex, 16))
    }

    const toBase64 = byteArray => {
        let str = tf.byteArrayToString(byteArray);
        let res = [];
        console.log(byteArray);

        for (let i of str) {
            res.push(i.codePointAt(0).toString(16));
        }

        return btoa(res.join('|'));
    }

    const trimByteArray = arr => arr.filter(Number);

    let _encr;

    const encrypted = tf.encrypt(tf.stringToByteArray(key2), tf.stringToByteArray(plaintext));
	console.log(toBase64(encrypted));
    console.log(trimByteArray(tf.decrypt(tf.stringToByteArray(key2), encrypted)));

    const [input, key, encrypt, decrypt, output] =
		['input', 'key', 'encrypt', 'decrypt', 'output'].map(id => document.getElementById(id));

	encrypt.addEventListener('click', e => {
		if (!input.value || !key.value) {
			throw new Error('Input and/or key are empty');
		}

        console.log(key.value, input.value);

        const encrypted = tf.encrypt(tf.stringToByteArray(key.value), tf.stringToByteArray(input.value));

        _encr = encrypted;
        console.log(_encr);
		output.value = toBase64(encrypted);
	});

	decrypt.addEventListener('click', e => {
		if (!input.value || !key.value) {
			throw new Error('Input and/or key are empty');
		}

        console.log(atob(output.value).split('|').map(hex => parseInt(hex, 16)), _encr);

        const decrypted = tf.decrypt(tf.stringToByteArray(key.value), fromBase64(output.value));
console.log(decrypted);
        output.value = tf.byteArrayToString(decrypted);
	});
});
</script>
</body>
</html>